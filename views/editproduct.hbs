<main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
    <h2 class="text-center my-4">Edit product</h2>


    <div class="row mb-3">
        <div class="col-md-8 col-sm-12 mb-2">

        </div>
        <div class="col-md-4 col-sm-12 text-md-end text-sm-start">

        </div>

    </div>
    <div class="col-md-6">

        <div class="card">

            <div class="card-body">

                <form action="/admin/edit-productsubmit/{{products._id}}" method="POST"
                    onsubmit="return validateEditProduct()" enctype="multipart/form-data">

                    <div class="mb-3">
                        <label for="categoryName" class="form-label">Product Name</label>
                        <input type="text" class="form-control" id="productName" name="productName"
                            value="{{products.name}}">
                        <div id="error-name" class="error-msg"></div>
                    </div>

                    <div class="mb-3">
                        <label for="brand" class="form-label">Brand</label>
                        <select class="form-control" id="brand" name="brand">
                            <option value="">Select a brand</option>
                            {{#each arr2}}
                            <option value="{{_id}}" {{selected}}>{{name}}</option>
                            {{/each}}
                        </select>
                        <div id="error-brand" class="error-msg"></div>
                    </div>


                    <div class="mb-3">
                        <label for="price" class="form-label">Price</label>
                        <input type="text" class="form-control" id="price" name="price" value="{{products.price}}">
                        <div id="error-price" class="error-msg"></div>
                    </div>

                    <div class="mb-3">
                        <label for="description" class="form-label">Description</label>
                        <input type="text" class="form-control" id="description" name="description"
                            value="{{products.description}}">
                        <div id="error-description" class="error-msg"></div>
                    </div>
                    <div class="mb-3">
                        <label for="category" class="form-label">Category</label>
                        <select class="form-control" id="category" name="category">
                            <option value="">Select a category</option>
                            {{#each arr}}
                            <option value="{{_id}}" {{selected}}>{{name}}</option>
                            {{/each}}
                        </select>
                        <div id="error-category" class="error-msg"></div>
                    </div>

                    <div class="mb-3">
                        <label for="size" class="form-label">Choose Size available</label>
                        <select class="form-control" id="size" name="size" multiple>
                            <option value="">Select a size</option>
                            {{#each newSizeArr}}
                            <option value="{{this.size}}" {{this.selected}}>{{this.size}}</option>
                            {{/each}}
                        </select>
                        <div id="error-size" class="error-msg"></div>
                    </div>

                    <div class="mb-3">
                        <label for="color" class="form-label">Choose color available</label>
                        <select class="form-control" id="color" name="color" multiple>
                            <option value="">Select a color</option>
                            {{#each newColorArr}}
                            <option value="{{this.color}}" {{this.selected}}>{{this.color}}</option>
                            {{/each}}
                        </select>
                        <div id="error-color" class="error-msg"></div>
                    </div>

                    <div class="mb-3">
                        <label for="stock" class="form-label">Stock</label>
                        <input type="number" class="form-control" id="stock" name="stock" value="{{products.stock}}">
                        <div id="error-stock" class="error-msg"></div>
                    </div>

                    <div class="mb-3">
                        <label for="status" class="form-label">Status</label>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="status" name="status" value="true" {{#if
                                products.status}}checked{{/if}}>
                            <label class="form-check-label" for="status">
                                {{#if products.status}}Active{{else}}Inactive{{/if}}
                            </label>
                        </div>
                        <div id="error-status" class="error-msg"></div>
                    </div>


                    <div class="mb-3">
                        <label for="image" class="form-label">Product Image</label>
                        <input type="file" class="form-control" id="image" name="image" accept="image/*">


                        <div id="existing-image-preview" class="mt-3">
                            {{#if products.image}}
                            <img src="/uploads/{{products.image}}" alt="Current Product Image" class="img-thumbnail"
                                style="width: 150px; height: 150px; object-fit: cover;">
                            <button type="button" class="btn btn-danger btn-sm mt-2"
                                id="remove-existing-image">Remove</button>
                            {{/if}}
                        </div>

                        <div id="image-preview" class="mt-3"></div>
                        <div id="error-image" class="error-msg"></div>
                    </div>


                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary">Submit</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    </div>
    </div>
    </section>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const imageInput = document.getElementById("image");
            const previewContainer = document.getElementById("image-preview");
            const existingImagePreview = document.getElementById("existing-image-preview");
            const removeExistingImageBtn = document.getElementById("remove-existing-image");

            // Handle new image preview
            imageInput.addEventListener("change", () => {
                previewContainer.innerHTML = ""; // Clear existing preview

                const file = imageInput.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const img = document.createElement("img");
                        img.src = e.target.result;
                        img.alt = "Selected Product Image";
                        img.style.width = "150px";
                        img.style.height = "150px";
                        img.style.objectFit = "cover";
                        img.className = "img-thumbnail";

                        const removeBtn = document.createElement("button");
                        removeBtn.textContent = "Remove";
                        removeBtn.className = "btn btn-danger btn-sm mt-2";
                        removeBtn.onclick = () => {
                            imageInput.value = ""; // Reset file input
                            previewContainer.innerHTML = ""; // Clear preview
                        };

                        previewContainer.appendChild(img);
                        previewContainer.appendChild(removeBtn);
                    };
                    reader.readAsDataURL(file);
                }
            });

            // Handle removing existing image
            if (removeExistingImageBtn) {
                removeExistingImageBtn.addEventListener("click", () => {
                    existingImagePreview.innerHTML = ""; // Clear existing image preview
                });
            }
        });

    </script>
    <script src="/javascripts/editproduct.js"></script>

    </body>

    </html>